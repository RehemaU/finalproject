<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sist.web.dao.EditorDao">
	<!-- 게시판 리스트 resultMap -->
	  <resultMap type="com.sist.web.model.Editor" id="editorResultMap">
	  	   <id column="PLAN_ID" property="planId" />
	       <result column="USER_ID" property="userId" />
		   <result column="PLAN_TITLE" property="planTitle" />
	       <result column="PLAN_CONTENT" property="planContent" />
	       <result column="PLAN_REGDATE" property="planRegdate" />
	       <result column="PLAN_COUNT" property="planCount" />
	       <result column="PLAN_REPORT" property="planReport" />
	       <result column="PLAN_RECOMMEND" property="planRecommend" />
	       <result column="T_CALANDER_LIST_ID" property="tCalanderListId"/>
	  </resultMap>
	  
	  <!-- 게시글 등록 -->
	  <insert id="editorInsert" parameterType="com.sist.web.model.Editor">

		INSERT INTO T_PLAN (PLAN_ID,
		USER_ID,
		PLAN_TITLE,
		PLAN_CONTENT,
		PLAN_REGDATE,
		PLAN_COUNT,
		PLAN_REPORT,
		PLAN_RECOMMEND,
		T_CALANDER_LIST_ID)
		VALUES (PLAN_SEQ.NEXTVAL,
		'user1',
		#{planTitle},
		#{planContent},
		SYSDATE,
		0,
		0,
		0,
		#{tCalanderListId})

	  </insert>
	  
	  <!-- 게시글 갯수 조회 (조건포함) -->
		<select id="editorListCount" parameterType="com.sist.web.model.Editor" resultType="int">
		  
		  SELECT COUNT(*)
		    FROM T_PLAN A
		    JOIN T_USER B
		      ON A.USER_ID = B.USER_ID
		      
		  <where>
		  	<if test='searchType != null and searchType != "" and searchValue != null and searchValue !=""'>
		  	<choose>
			    <when test='searchType == "1"'>
			      AND B.USER_NAME LIKE '%' || #{searchValue} || '%'
			    </when>
			    <when test='searchType == "2"'>
			      AND A.PLAN_TITLE LIKE '%' || #{searchValue} || '%'
			    </when>
			    <when test='searchType == "3"'>
			      AND DBMS_LOB.INSTR(A.PLAN_CONTENT, #{searchValue}) &gt; 0
			    </when>
		    </choose>
		    </if>
		  </where>
		  
		</select>

	  
	  <!-- 게시글 전체 리스트 (조건포함) -->
	  <select id="editorList" parameterType="com.sist.web.model.Editor" resultMap="editorResultMap">
	  
		    SELECT
		    A.PLAN_ID PLAN_ID,
		    A.USER_ID USER_ID,
		    A.PLAN_TITLE PLAN_TITLE,
		    A.PLAN_CONTENT PLAN_CONTENT,
		    TO_CHAR(A.PLAN_REGDATE, 'YYYY.MM.DD HH24:MI:SS') PLAN_REGDATE,
		    A.PLAN_COUNT PLAN_COUNT,
		    A.PLAN_REPORT PLAN_REPORT,
		    A.PLAN_RECOMMEND PLAN_RECOMMEND,
		    A.T_CALANDER_LIST_ID T_CALANDER_LIST_ID
		  FROM T_PLAN A
		  JOIN T_USER B
		    ON A.USER_ID = B.USER_ID
		
		  <!-- searchType 1: 이름으로 검색 -->
		  <!-- searchType 2: 제목으로 검색 -->
		  <!-- searchType 3: 내용으로 검색 -->
		  <where>
		  	<if test='searchType != null and searchType != "" and searchValue != null and searchValue !=""'>
		  	<choose>
			    <when test='searchType == "1"'>
			      AND B.USER_NAME LIKE '%' || #{searchValue} || '%'
			    </when>
			    <when test='searchType == "2"'>
			      AND A.PLAN_TITLE LIKE '%' || #{searchValue} || '%'
			    </when>
			    <when test='searchType == "3"'>
			      AND DBMS_LOB.INSTR(A.PLAN_CONTENT, #{searchValue}) &gt; 0
			    </when>
		    </choose>
		    </if>
		  </where>
		
		  <!-- listType 1: 최신순(기본) -->
		  <!-- listType 2: 추천순 -->
		  <!-- listType 3: 조회수순 -->
		  <choose>
		    <when test='listType == "1"'>
		      ORDER BY A.PLAN_REGDATE DESC
		    </when>
		    <when test='listType == "2"'>
		      ORDER BY A.PLAN_RECOMMEND DESC
		    </when>
		    <when test='listType == "3"'>
		      ORDER BY A.PLAN_COUNT DESC
		    </when>
		    <otherwise>
		      <!-- 최신순(기본) -->
		      ORDER BY A.PLAN_REGDATE DESC
		    </otherwise>
		  </choose>
	  
	  </select>
	  
	  <!-- 게시글 상세 조회 -->
	  <select id="editorSelect" parameterType="int" resultMap="editorResultMap">
			SELECT
			    A.PLAN_ID,
			    A.USER_ID,
			    A.PLAN_TITLE,
			    A.PLAN_CONTENT,
			    A.PLAN_REGDATE,
			    A.PLAN_COUNT,
			    A.PLAN_REPORT,
			    A.PLAN_RECOMMEND,
			    A.T_CALANDER_LIST_ID
			FROM
			    T_PLAN A
			  JOIN
			    T_USER B
			    ON A.USER_ID = B.USER_ID
			WHERE
			A.PLAN_ID = #{value}
	  </select>
	  
	  <!-- 게시물 수정 -->
		<update id="editorUpdate" parameterType="com.sist.web.model.Editor">
			UPDATE T_PLAN
			   SET PLAN_TITLE = #{planTitle},
			       PLAN_CONTENT = #{planContent}
			 WHERE PLAN_ID = #{planId}
		</update>
		
		<!-- 게시물 삭제 -->
		<delete id="editorDelete" parameterType="int">
		DELETE T_PLAN
		WHERE PLAN_ID = #{value}
		</delete>
	  
</mapper>
