<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sist.manager.dao.AccommodationDao">

    <resultMap id="accomResultMap" type="com.sist.manager.model.Accommodation">
        <id column="ACCOMM_ID" property="accomId"/>
        <result column="REGION_ID" property="regionId"/>
        <result column="SIGUNGU_CODE" property="sigunguCode"/>
        <result column="ZIPCODE" property="zipcode"/>
        <result column="SELLER_ID" property="sellerId"/>
        <result column="ACCOMM_STATUS" property="accomStatus"/>
        <result column="ACCOMM_NAME" property="accomName"/>
        <result column="ACCOMM_TEL" property="accomTel"/>
        <result column="ACCOMM_ADD" property="accomAdd"/>
        <result column="ACCOMM_ADD2" property="accomAdd2"/>
        <result column="ACCOMM_DES" property="accomDes"/>
        <result column="ACCOMM_LAT" property="accomLat"/>
        <result column="ACCOMM_LON" property="accomLon"/>
        <result column="FIRST_IMAGE" property="firstImage"/>
        <result column="FIRST_IMAGE2" property="firstImage2"/>
        <result column="ACCOMM_AVG" property="accomAvg"/>
    </resultMap>

    <insert id="insertAccommodation" parameterType="com.sist.manager.model.Accommodation">
	    INSERT INTO T_ACCOMM (
	        ACCOMM_ID, UNIFIED_ID, REGION_ID, SIGUNGU_CODE, ZIPCODE, SELLER_ID, ACCOMM_STATUS,
	        ACCOMM_NAME, ACCOMM_TEL, ACCOMM_ADD, ACCOMM_ADD2, ACCOMM_DES,
	        ACCOMM_LAT, ACCOMM_LON, FIRST_IMAGE, FIRST_IMAGE2, ACCOMM_AVG
	    )
	    SELECT 
	        #{accomId}, 
	        CONCAT('A_', TO_CHAR(ACCOMM_SEQ.NEXTVAL)), 
	        #{regionId}, #{sigunguCode}, #{zipcode}, #{sellerId}, #{accomStatus},
	        #{accomName}, #{accomTel}, #{accomAdd}, #{accomAdd2}, #{accomDes, jdbcType=CLOB},
	        #{accomLat}, #{accomLon}, #{firstImage}, #{firstImage2}, #{accomAvg}
	    FROM dual
	    WHERE NOT EXISTS (
	        SELECT 1 FROM T_ACCOMM WHERE ACCOMM_ID = #{accomId}
	    )
	</insert>

    <select id="getAllAccommodations" resultMap="accomResultMap">
        SELECT * FROM T_ACCOMM
    </select>
    

	
	<select id="existsAccommodation" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM T_ACCOMM WHERE ACCOMM_ID = #{accomId}
	</select>
	
</mapper>
