<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace= "com.sist.finalproject.dao.EventDao">
  <!-- 이벤트 등록 -->
    <insert id="insertEvent" parameterType="com.sist.finalproject.model.Event">
        INSERT INTO T_EVENT (
            EVENT_ID,
            ADMIN_ID,
            COUPON_ID,
            EVENT_TITLE,
            EVENT_CONTENT,
            EVENT_REGDATE,
            EVENT_COUNT
        ) VALUES (
            #{eventId},
            #{adminId},
            #{couponId},
            #{eventTitle},
            #{eventContent},
            SYSDATE,
            0
        )
    </insert>

    <!-- 이벤트 목록 조회 -->
    <select id="selectEventList" resultType="com.sist.manager.model.Event">
        SELECT
            EVENT_ID,
            ADMIN_ID,
            COUPON_ID,
            EVENT_TITLE,
            EVENT_CONTENT,
            EVENT_REGDATE,
            EVENT_COUNT
        FROM T_EVENT
        ORDER BY EVENT_REGDATE DESC
    </select>

    <!-- 단건 조회 -->
    <select id="selectEventById" parameterType="String" resultType="com.sist.manager.model.Event">
        SELECT
            EVENT_ID,
            ADMIN_ID,
            COUPON_ID,
            EVENT_TITLE,
            EVENT_CONTENT,
            EVENT_REGDATE,
            EVENT_COUNT
        FROM T_EVENT
        WHERE EVENT_ID = #{eventId}
    </select>

    <!-- 이벤트 수정 -->
    <update id="updateEvent" parameterType="com.sist.manager.model.Event">
        UPDATE T_EVENT
        SET
            EVENT_TITLE = #{eventTitle},
            EVENT_CONTENT = #{eventContent},
            COUPON_ID = #{couponId}
        WHERE EVENT_ID = #{eventId}
    </update>

    <!-- 이벤트 삭제 -->
    <delete id="deleteEvent" parameterType="String">
        DELETE FROM T_EVENT
        WHERE EVENT_ID = #{eventId}
    </delete>

    <!-- 조회수 증가 -->
    <update id="increaseEventCount" parameterType="String">
        UPDATE T_EVENT
        SET EVENT_COUNT = EVENT_COUNT + 1
        WHERE EVENT_ID = #{eventId}
    </update>
    
    <!-- 이벤트체크 -->
    <select id="existsEvent" parameterType="String" resultType="int">
    SELECT COUNT(*) FROM T_EVENT WHERE EVENT_ID = #{eventId}
	</select>
	
	<select id="selectEventListPaging" parameterType="map" resultType="com.sist.manager.model.Event">
    SELECT * FROM (
        SELECT A.*, ROWNUM RN FROM (
            SELECT
                EVENT_ID,
                ADMIN_ID,
                COUPON_ID,
                EVENT_TITLE,
                EVENT_CONTENT,
                EVENT_REGDATE,
                EVENT_COUNT
            FROM T_EVENT
            ORDER BY EVENT_REGDATE DESC
        ) A WHERE ROWNUM &lt;= #{end}
    ) WHERE RN &gt;= #{start}
</select>
	
</mapper>
